<template>
  <div class="space-y-8">
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div class="text-center animate-fade-in">
      <h1
        class="text-4xl font-bold text-white mb-4 bg-gradient-to-r from-red-500 to-yellow-500 bg-clip-text text-transparent"
      >
        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –¢—é—Ä—è–≥—É, {{ user?.nickname }}!
      </h1>
      <p class="text-gray-400 text-lg">
        –£—Ä–æ–≤–µ–Ω—å {{ user?.level }} ‚Ä¢ {{ formatMoney(user?.money) }} –¥–µ–Ω–µ–≥ ‚Ä¢
        {{ user?.respect }} —É–≤–∞–∂–µ–Ω–∏—è
      </p>
      <div class="mt-4 flex justify-center space-x-4">
        <div
          class="flex items-center space-x-2 bg-gray-800 px-4 py-2 rounded-lg"
        >
          <span class="text-yellow-400">‚ö°</span>
          <span class="text-white">{{ user?.energy || 0 }}/100</span>
        </div>
        <div
          class="flex items-center space-x-2 bg-gray-800 px-4 py-2 rounded-lg"
        >
          <span class="text-green-400">üí∞</span>
          <span class="text-white">{{ formatMoney(user?.money || 0) }}</span>
        </div>
        <div
          class="flex items-center space-x-2 bg-gray-800 px-4 py-2 rounded-lg"
        >
          <span class="text-purple-400">üëë</span>
          <span class="text-white">{{ user?.respect || 0 }}</span>
        </div>
      </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- –ë–æ—Å—Å—ã -->
      <div
        class="card hover:bg-gray-750 transition-all duration-300 cursor-pointer transform hover:scale-105 hover:shadow-xl border-l-4 border-red-500"
        @click="navigateTo('/bosses')"
      >
        <div class="text-center">
          <div class="text-5xl mb-3 animate-pulse">üëπ</div>
          <h3 class="text-xl font-bold text-red-400 mb-2">–ë–æ—Å—Å—ã</h3>
          <p class="text-gray-400 text-sm mb-3">
            –°—Ä–∞–∂–∞–π—Ç–µ—Å—å —Å –±–æ—Å—Å–∞–º–∏ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—ã
          </p>
          <div class="text-xs text-gray-500">
            {{ activeBosses.length }} –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Å—Å–æ–≤
          </div>
        </div>
      </div>

      <!-- –ë—Ä–∞—Ç–≤–∞ -->
      <div
        class="card hover:bg-gray-750 transition-colors cursor-pointer"
        @click="navigateTo('/clans')"
      >
        <div class="text-center">
          <div class="text-4xl mb-3">üè¥</div>
          <h3 class="text-xl font-bold text-blue-400 mb-2">–ë—Ä–∞—Ç–≤–∞</h3>
          <p class="text-gray-400 text-sm">
            –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ –∫–ª–∞–Ω—É
          </p>
        </div>
      </div>

      <!-- –ú–∞–≥–∞–∑–∏–Ω -->
      <div
        class="card hover:bg-gray-750 transition-all duration-300 cursor-pointer transform hover:scale-105 hover:shadow-xl border-l-4 border-yellow-500"
        @click="navigateTo('/shop')"
      >
        <div class="text-center">
          <div class="text-5xl mb-3 animate-bounce">üõí</div>
          <h3 class="text-xl font-bold text-yellow-400 mb-2">–ú–∞–≥–∞–∑–∏–Ω</h3>
          <p class="text-gray-400 text-sm mb-3">
            –ü–æ–∫—É–ø–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ, –±—Ä–æ–Ω—é –∏ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏
          </p>
          <div class="text-xs text-gray-500">
            {{ formatMoney(user?.money || 0) }} üí∞
          </div>
        </div>
      </div>

      <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
      <div
        class="card hover:bg-gray-750 transition-all duration-300 cursor-pointer transform hover:scale-105 hover:shadow-xl border-l-4 border-green-500"
        @click="navigateTo('/profile')"
      >
        <div class="text-center">
          <div class="text-5xl mb-3 animate-spin">üë§</div>
          <h3 class="text-xl font-bold text-green-400 mb-2">–ü—Ä–æ—Ñ–∏–ª—å</h3>
          <p class="text-gray-400 text-sm mb-3">
            –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–≤–æ–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
          </p>
          <div class="text-xs text-gray-500">
            –£—Ä–æ–≤–µ–Ω—å {{ user?.level || 1 }}
          </div>
        </div>
      </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="card">
      <h2 class="text-xl font-bold text-white mb-4">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="text-center">
          <div class="text-2xl font-bold text-blue-400">
            {{ user?.level || 0 }}
          </div>
          <div class="text-sm text-gray-400">–£—Ä–æ–≤–µ–Ω—å</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-green-400">
            {{ formatMoney(user?.money || 0) }}
          </div>
          <div class="text-sm text-gray-400">–î–µ–Ω—å–≥–∏</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-purple-400">
            {{ user?.respect || 0 }}
          </div>
          <div class="text-sm text-gray-400">–£–≤–∞–∂–µ–Ω–∏–µ</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-yellow-400">
            {{ user?.energy || 0 }}
          </div>
          <div class="text-sm text-gray-400">–≠–Ω–µ—Ä–≥–∏—è</div>
        </div>
      </div>
    </div>

    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –±–æ—Å—Å—ã -->
    <div class="card">
      <h2 class="text-xl font-bold text-white mb-4">–ê–∫—Ç–∏–≤–Ω—ã–µ –±–æ—Å—Å—ã</h2>
      <div
        v-if="activeBosses.length === 0"
        class="text-center text-gray-400 py-8"
      >
        <div class="text-4xl mb-2">üò¥</div>
        <p>–°–µ–π—á–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Å—Å–æ–≤</p>
      </div>
      <div v-else class="space-y-3">
        <div
          v-for="boss in activeBosses"
          :key="boss.id"
          class="flex items-center justify-between p-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors cursor-pointer"
          @click="navigateTo(`/bosses/${boss.id}`)"
        >
          <div class="flex items-center space-x-3">
            <div class="text-2xl">üëπ</div>
            <div>
              <div class="font-bold text-white">{{ boss.name }}</div>
              <div class="text-sm text-gray-400">–£—Ä–æ–≤–µ–Ω—å {{ boss.level }}</div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm text-red-400">
              {{ boss.currentHp }}/{{ boss.maxHp }} HP
            </div>
            <div class="w-20 bg-gray-600 rounded-full h-2 mt-1">
              <div
                class="bg-red-500 h-2 rounded-full"
                :style="{ width: `${(boss.currentHp / boss.maxHp) * 100}%` }"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useAuthStore } from '~/stores/auth';

const authStore = useAuthStore();
const user = computed(() => authStore.user);

const activeBosses = ref([]);

const formatMoney = amount => {
  return new Intl.NumberFormat('ru-RU').format(amount);
};

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Å—Å–æ–≤
const loadActiveBosses = async () => {
  try {
    const config = useRuntimeConfig();
    const authStore = useAuthStore();

    const response = await $fetch(`${config.public.apiBase}/api/boss`, {
      headers: {
        Authorization: `Bearer ${authStore.token}`
      }
    });

    if (response.ok) {
      activeBosses.value = response.data.bosses.filter(
        boss => boss.state === 'active'
      );
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Å—Å–æ–≤:', error);
  }
};

onMounted(() => {
  loadActiveBosses();
});

// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
definePageMeta({
  middleware: 'auth'
});
</script>
